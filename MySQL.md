# 基础

## SQL语句执行

### 连接器

>+ 与客户端进行TCP三次握手建立连接
>+ 校验客户端的用户名和密码，如果用户名或者密码不对，则会报错
>+ 如果正确，读取用户的权限，后面的逻辑判断都基于此时读到的权限

> 权限在连接后更改不会立即生效，只有新建立的连接才会使用新的权限设置
>
> 连接有最大空闲时长，默认8小时；有最大连接数

### 查询缓存

### 解析SQL

> + 词法分析 识别出关键字
> + 语法分析 根据词法分析结果，判断SQL语句是否满足MySQL语法，没问题就建立语法树

### 执行SQL

> + prepare阶段 (预处理阶段)
>
>   > 检查SQL查询语句中的表或者字段是否存在
>
> + optimize阶段 （优化阶段）
>
>   > 将SQL查询语句的执行方案确定下来
>
> + execute阶段 （执行阶段）
>
>   > + 主键索引查询
>   >
>   > + 全表扫描
>   > + 索引下推





### 执行一条 SQL 查询语句，期间发生了什么？

- 连接器：建立连接，管理连接、校验用户身份；
- 查询缓存：查询语句如果命中查询缓存则直接返回，否则继续往下执行。MySQL 8.0 已删除该模块；
- 解析 SQL，通过解析器对 SQL 查询语句进行词法分析、语法分析，然后构建语法树，方便后续模块读取表名、字段、语句类型；
- 执行 SQL：执行 SQL 共有三个阶段：
  - 预处理阶段：检查表或字段是否存在；将 `select *` 中的 `*` 符号扩展为表上的所有列。
  - 优化阶段：基于查询成本的考虑， 选择查询成本最小的执行计划；
  - 执行阶段：根据执行计划执行 SQL 查询语句，从存储引擎读取记录，返回给客户端；